{% extends 'base.html' %}
{% load static %}

{% block content %}
<section class="page-header">
    <div class="page-header__bg"
        style="background-image: url('{% static 'assets/images/backgrounds/page-header-bg1-1.jpg' %}')"></div>
    <div class="page-header__overlay"></div>
    <div class="container">
        <h2 class="page-header__title">Qidiruv natijalari</h2>
        <ul class="grdeen-breadcrumb list-unstyled">
            <li><a href="{% url 'home' %}">Bosh sahifa</a></li>
            <li><span>Qidiruv</span></li>
        </ul>
    </div>
</section>

<section class="search-results section-space">
    <div class="container">
        {% if query %}
        <div class="search-info mb-5">
            <h3>Qidiruv natijalari uchun "{{ query }}"</h3>
            <p class="text-muted">Topilgan {{ total_results }} natija{{ total_results|pluralize }} ({{ products_count }}
                mahsulot{{ products_count|pluralize }}, {{ services_count }} xizmat{{ services_count|pluralize }})</p>
        </div>
        {% endif %}

        {% if not query %}
        <div class="text-center">
            <div class="search-icon mb-4">
                <i class="icon-search" style="font-size: 64px; color: #ccc;"></i>
            </div>
            <h3>Qidiruv so'zini kiriting</h3>
            <p class="text-muted">Iltimos, mahsulotlar va xizmatlarni qidirish uchun kalit so'z kiriting.</p>
        </div>
        {% elif total_results == 0 %}
        <div class="text-center">
            <div class="search-icon mb-4">
                <i class="fas fa-search" style="font-size: 64px; color: #ccc;"></i>
            </div>
            <h3>Natija topilmadi</h3>
            <p class="text-muted">Kechirasiz, "{{ query }}" ga mos keladigan mahsulotlar yoki xizmatlar topilmadi. Iltimos, boshqa kalit so'zlarni sinab ko'ring.</p>
            <a href="{% url 'products' %}" class="grdeen-btn mt-3">
                <span>Barcha mahsulotlarni ko'rish</span>
            </a>
        </div>
        {% else %}

        <!-- Services Results -->
        {% if services_count > 0 %}
        <div class="services-results mb-5 service-one service-one--three">
            <div class="row">
                <div class="col-12">
                    <h4 class="mb-4">Xizmatlar ({{ services_count }} topildi)</h4>
                </div>
            </div>
            <div class="row gutter-y-30">
                {% for service in services %}
                <div class="col-lg-4 col-md-6">
                        <div class="service-one__item">
                            <div class="service-one__item__bgeffect" style="background-image: url('{% static 'assets/images/shapes/service-shape3-1.png' %}');"></div>
                            <div class="service-one__item__titlewrap">
                                <div class="service-one__item__titlecol">
                                    <h4 class="service-one__item__title">
                                        <a href="{% url 'service_details' service.id %}">{{ service.pagename }}</a>
                                    </h4>
                                    <p class="service-one__item__text">{{ service.description|truncatewords:15 }}</p>
                                    <a class="service-one__item__link" href="{% url 'service_details' service.id %}">Batafsil</a>
                                </div>
                            </div>
                            <div class="service-one__item__image">
                                <img src="{{ service.image.url }}" alt="{{ service.pagename }}">
                                <div class="service-one__item__iconwrap">
                                    <div class="service-one__item__icon">
                                        {{ service.icon|safe }}
                                    </div><!-- /.service-icon -->
                                </div>
                                <div class="service-one__item__btmwrap">
                                    <a class="service-one__item__iconlink" href="{% url 'service_details' service.id %}">
                                        <i class="icon-right-up"></i>
                                    </a>
                                </div>
                            </div>
                        </div><!-- /.service-card-one -->
                    </div>
                {% endfor %}
            </div>

            <!-- Services Pagination -->
            {% if services.has_other_pages %}
            <div class="pagination-wrapper text-center mt-4">
                <ul class="pg-pagination list-unstyled">
                    {% if services.has_previous %}
                    <li class="pg-pagination__item">
                        <a href="?q={{ query }}&services_page={{ services.previous_page_number }}{% if request.GET.products_page %}&products_page={{ request.GET.products_page }}{% endif %}"
                            class="pg-pagination__link">
                            <i class="icon-left-arrow"></i>
                        </a>
                    </li>
                    {% endif %}

                    {% for num in services.paginator.page_range %}
                    {% if services.number == num %}
                    <li class="pg-pagination__item">
                        <a href="#" class="pg-pagination__link pg-pagination__link--current">{{ num }}</a>
                    </li>
                    {% elif num > services.number|add:'-3' and num < services.number|add:'3' %} <li
                        class="pg-pagination__item">
                        <a href="?q={{ query }}&services_page={{ num }}{% if request.GET.products_page %}&products_page={{ request.GET.products_page }}{% endif %}"
                            class="pg-pagination__link">{{ num }}</a>
                        </li>
                        {% endif %}
                        {% endfor %}

                        {% if services.has_next %}
                        <li class="pg-pagination__item">
                            <a href="?q={{ query }}&services_page={{ services.next_page_number }}{% if request.GET.products_page %}&products_page={{ request.GET.products_page }}{% endif %}"
                                class="pg-pagination__link">
                                <i class="icon-right-arrow"></i>
                            </a>
                        </li>
                        {% endif %}
                </ul>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Products Results -->
        {% if products_count > 0 %}
        <div class="products-results">
            <div class="row">
                <div class="col-12">
                    <h4 class="mb-4">mahsulotlar ({{ products_count }} topildi)</h4>
                </div>
            </div>
            <div class="row gutter-y-30">
                {% for product in products %}
                 {% include 'includes/product_card.html' %}
                {% endfor %}
            </div>

            <!-- Products Pagination -->
            {% if products.has_other_pages %}
            <div class="pagination-wrapper text-center mt-4">
                <ul class="pg-pagination list-unstyled">
                    {% if products.has_previous %}
                    <li class="pg-pagination__item">
                        <a href="?q={{ query }}&products_page={{ products.previous_page_number }}{% if request.GET.services_page %}&services_page={{ request.GET.services_page }}{% endif %}"
                            class="pg-pagination__link">
                            <i class="icon-left-arrow"></i>
                        </a>
                    </li>
                    {% endif %}

                    {% for num in products.paginator.page_range %}
                    {% if products.number == num %}
                    <li class="pg-pagination__item">
                        <a href="#" class="pg-pagination__link pg-pagination__link--current">{{ num }}</a>
                    </li>
                    {% elif num > products.number|add:'-3' and num < products.number|add:'3' %} <li
                        class="pg-pagination__item">
                        <a href="?q={{ query }}&products_page={{ num }}{% if request.GET.services_page %}&services_page={{ request.GET.services_page }}{% endif %}"
                            class="pg-pagination__link">{{ num }}</a>
                        </li>
                        {% endif %}
                        {% endfor %}

                        {% if products.has_next %}
                        <li class="pg-pagination__item">
                            <a href="?q={{ query }}&products_page={{ products.next_page_number }}{% if request.GET.services_page %}&services_page={{ request.GET.services_page }}{% endif %}"
                                class="pg-pagination__link">
                                <i class="icon-right-arrow"></i>
                            </a>
                        </li>
                        {% endif %}
                </ul>
            </div>
            {% endif %}
        </div>
        {% endif %}

        {% endif %}
    </div>
</section>

<!-- Advanced Search Section -->
{% if query and total_results > 0 %}
<section class="search-suggestions section-space-bottom">
    <div class="container">
        <div class="text-center">
            <h4>Izlashda topa olmadingizmi?</h4>
            <p class="text-muted mb-4">Iltimos, kategoriyalarimizni ko'rib chiqing yoki yordam uchun biz bilan bog'laning.</p>
            <div class="row justify-content-center">
                <div class="col-md-3">
                    <a href="{% url 'products' %}" class="grdeen-btn w-100">
                        <span>Barcha mahsulotlar</span>
                    </a>
                </div>
                <div class="col-md-3">
                    <a href="{% url 'services' %}" class="grdeen-btn w-100">
                        <span>Barcha xizmatlar</span>
                    </a>
                </div>
                <div class="col-md-3">
                    <a href="{% url 'contact' %}" class="grdeen-btn w-100">
                        <span>Biz bilan bog'laning</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

{% endblock %}